<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Admin Dashboard</h2>
    <button id="downloadExcel" class="btn btn-success">Download Excel</button>
</div>

<div class="row mb-3">
    <div class="col-md-4">
        <input type="text" id="searchInput" class="form-control" placeholder="Search by name or email">
    </div>
    <div class="col-md-3">
        <select id="statusFilter" class="form-select">
            <option value="">All Status</option>
            <option value="paid">Paid</option>
            <option value="pending">Pending</option>
        </select>
    </div>
    <div class="col-md-3">
        <select id="passFilter" class="form-select">
            <option value="">All Pass Types</option>
            <option value="general">General Pass</option>
            <option value="team">Team Pass</option>
        </select>
    </div>
</div>


<script>
    let campersData = [];
    
    async function fetchCampers() {
        const res = await fetch('/admin/campers');
        campersData = await res.json();
        renderTable(campersData);
    }
    
    function renderTable(data) {
        const tbody = document.querySelector('#campersTable tbody');
        tbody.innerHTML = data.map(c => `
            <tr>
                <td>${c.fullname}</td>
                <td>${c.email}</td>
                <td>${c.phone}</td>
                <td>${c.pass_type}</td>
                <td>${c.amount}</td>
                <td>${c.payment_status}</td>
            </tr>
        `).join('');
    }
    
    function applyFilters() {
        const searchValue = document.getElementById('searchInput').value.toLowerCase();
        const statusValue = document.getElementById('statusFilter').value;
        const passValue = document.getElementById('passFilter').value;
    
        let filtered = campersData.filter(c => {
            const matchesSearch = c.fullname.toLowerCase().includes(searchValue) ||
                                  c.email.toLowerCase().includes(searchValue);
            const matchesStatus = !statusValue || c.payment_status === statusValue;
            const matchesPass = !passValue || c.pass_type === passValue;
    
            return matchesSearch && matchesStatus && matchesPass;
        });
    
        renderTable(filtered);
    }
    
    document.getElementById('searchInput').addEventListener('input', applyFilters);
    document.getElementById('statusFilter').addEventListener('change', applyFilters);
    document.getElementById('passFilter').addEventListener('change', applyFilters);
    
    document.getElementById("downloadExcel").addEventListener("click", () => {
        window.location.href = '/admin/download-excel';
    });
    
    fetchCampers();
    </script>